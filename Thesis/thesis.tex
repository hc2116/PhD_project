\documentclass[a4paper,12pt,twoside]{article}
\usepackage[left=3cm,right=3cm,top=2cm,bottom=3cm]{geometry}
%\usepackage[square,authoryear,sort]{natbib}
\usepackage{url}
\usepackage{xcolor}
\usepackage{graphicx}
%\usepackage{pdfpages}
\usepackage{subcaption}
%\usepackage{pgfgantt}
%\usepackage{dirtytalk}

\makeatletter
\def\@makesectionhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright \normalfont
    \interlinepenalty\@M
    \Huge\bfseries  \thesection.\quad #1\par\nobreak
    \vskip 40\p@
  }}
\makeatother

\makeatletter
\newcommand*{\toccontents}{\@starttoc{toc}}
\makeatother

\newtheorem{hypothesis}{Hypothesis}

\newtheorem{rquestion}{Research Question}


\let\endtitlepage\relax
\begin{document}

\title{\LARGE {\bf Semantic Modelling of Network Traffic for Anomaly Detection}\\
PhD 2\textsuperscript{nd} Year Progress Report
 \vspace*{-5mm}
}
\author{Henry Clausen}
%\date{October 2008}

\maketitle



\toccontents
%\begin{abstract}
%Text
%\end{abstract}


\section{Introduction}

\subsection{Summary of plans outlined in last years proposal}
This PhD-project was outlined to use the idea of semantic software models and apply it to network traffic data, and to employ methods from machine learning to automatically learn precise contextual models of network traffic generated by one or more machines. Specific goals of this research project were defined as following:
\begin{enumerate}

\item Build an understanding of how contextual structures manifest themselves in network traffic.
\item Develop a semantic model of traffic structures that works on different levels of traffic abstraction (packets or flows) and enables the incorporation of semantic features from the packet level on a flow-level to extend available flow information.
\item Provide a framework to generate traffic data with a high level of ground truth about traffic origins and purposes.
\item Introduce robustness to anomaly-based models by identifying gradual changes in network communication as traffic with common semantic substructures.

\end{enumerate}

These were formulating in last years proposal into the following sub-projects:

\begin{enumerate}
\item Modelling of connection establishment via LSTM encoders
\item Traffic generation and data fusion 
\item Software evolution and drift 
\item Flow-level based modelling
\end{enumerate}




Furthermore, the following (summarised) research questions were defined for each of these goals:

\begin{rquestion}\ \\ 
How well-structured is the space of contextual behaviours observed in the traffic of a machine or a network? How much does noise or input variation blur the observable contextual differences between clearly distinct actions?

%\begin{enumerate}
%\item How can we scientifically quantify closeness between individual actions, and does it translate into the similarity of corresponding traffic structures? 
%\end{enumerate}
\end{rquestion}



\begin{rquestion}\ \\
To what degree can contextual structure in network traffic be captured in a model from a training dataset, and how can we achieve this? How can a model adapt to changes of normal contextual structures?
%\begin{enumerate}
%\item Which parts of network traffic both contain important information and can be represented by a model?
%\item Can be combine models that act at different traffic levels to enhance the amount of context given by the data? 
%\item Can we efficiently disentangle overlaying network flows to isolate otherwise distorted flow groups corresponding to similar actions? 
%\item What is an efficient and realistic way to incorporate other data sources into the modelling procedure? How can this input enhance the learning process and the representation detail of a traffic model? 
%\item How can a model adapt to changes of normal contextual structures?
%\end{enumerate}
\end{rquestion}

\begin{rquestion}\ \\
What is a meaningful representation of traffic structures? What requirements must a labelled traffic generation framework fulfill to provide realistic data?
%\begin{enumerate}
%\item What requirements must a labelled traffic generation framework fulfill to provide realistic data?
%\item Can we evaluate the traffic representation of a model through its ability to identify contextual closeness between traffic instances correctly?
%\item How can we quantify the capability of a given traffic model to identify new computational actions on a machine?
%\end{enumerate}
\end{rquestion}


\begin{rquestion}\ \\
What will a contextual model be able to prevent? 
%\begin{enumerate}
%\item What kind of attacks will necessarily show contextual anomalies, and which will not?
%\item Can an adversary adapt his attacks to avoid detection? How can we prevent this?
%\end{enumerate}
\end{rquestion}


There has been substantial progress on research questions 1 and 3, which I outline below. Research question 2 has been answered partly, with research question 4 still to be addressed.  



\section{Research progress in the last year}
  
\subsection{Traffic Generation using Containerization for Machine Learning}

Building contextual models of network traffic means to build an understanding how different network interactions can be distinguished via their traffic trace. However, available network traffic datasets do not contain ground truth labels about the nature of computer interactions and often suffer from a lack of realism. To improve this and ensure that our models extract meaningful sets of sequences that represent these different interactions, we started developing a containerised traffic generation framework to generate traffic with ground truth labels. 

%Network traffic datasets are already hard to obtain due to privacy concerns. However, as  the correspondence between individual network traffic events and their particular purpose is virtually never recorded on a computer, very few datasets contain ground truth about the captured events. For that reason, a particular aspect of this project is to generate useful ground truth data with appropriate content myself.

This framework, called \textit{DetGen}, generates controlled and isolated network traffic from a variety of applications and tasks. For this, a virtual network was created using the virtualisation program \textit{Docker}. In this network, two or more parties can communicate through containers,  which are sandboxes containing programs inside a minimal virtualised operating system. The benefit of this design is that individual containers can only communicate with each other via the virtualised network while the host is in complete control of the parallel execution of tasks in multiple containers. To capture the traffic, every container in the network was complemented with a \textit{tcpdump}\footnote{A common packet capture utility} container hooked onto the network interface, see Fig. \ref{docker}. The captured traffic can then be labelled according to the particular scenario it was generated by. We implemented a variety of network service  scenarios to capture a diverse set of network traffic.

\begin{figure}
\centering
\includegraphics[width=0.7\textwidth]{images/Dockernet.jpg}
\caption{Visualisation of the virtual network in Docker}\label{docker}
\end{figure}


We emphasised the following particular strengths in the DetGen framework, which makes the generated data particularly suitable for ML-applications:
\begin{itemize}
\item traffic variation through a diversity of generation scenarios as well as transmission disturbances,
\item ground truth labels through containerised separation of generation scenarios,
\item scalability of the amount of generated traffic,
\item and modularity of the framework to easily extend and update the set of scenarios.
\end{itemize}



This work was started in summer 2018 by me and Nikola Pavlov (an LFCS summer intern), and continued in summer 2019 by me and Robert Flood (an LFCS MSc student). My responsibilities lied in overall design of the framework as well as the requirements on the generation features, testing and extending individual scenarios as well as implemention, and the design and conduction of validation experiments. 

In autumn of 2019, Robert Flood and I described DetGen in a paper of which I am first author, which was submitted and accepted at the ACSAC DYNAMICS workshop 2019, and will appear in the corresponding proceedings this March. 

Due to very positive feedback at the workshop as well as encouragements and suggestions to extend DetGen, we are working further on this project, which is described in Section \ref{Sec:dockerext}.

\subsection{Short-term contextual model of network flows using LSTM networks}\label{Sec:Short-term}

In the context of the overall research goal of this project, some exploratory work on contextual anomaly detection for network events was conducted before my PhD started by Marc Sabate, Gudmund Grov, Wei Chen, and David Aspinall. 
This work uses a recurrent neural network to capture meaningful sequences of \textit{NetFlows} and reflect reccurring patterns in a model. For that, recorded NetFlows are grouped according to the generating host. Furthermore, to filter out sequences of flows that are unrelated to each other, a squence of flows that are close in time is grouped into what is called a session as an approximation of the true relation. Each session then serves as a training or test sequence for a behavioural model. Learned contextual behaviour is reflected through the capability of the model to predict traffic protocols and network ports of flows in a session from a smaller subset of flows, with more accurate predictions being rewarded in the training process. Sessions which deviate from previously observed behaviour are then predicted poorly by the model and flagged as potentially malicious.

This work however was not yet complete for successful publication, which is why I took the responsibilty to improve it and bring it to a state suitable for publication. During my work, I made significant changes and additions to both improve the model performance as well as extend the evaluation to highlight the benefits and novelty of this work. 
In particular, I made the following major changes:

\begin{enumerate}
\item I specified the scope of the model to the detection of U2R and R2L attacks, to which it is more suited than high volume attacks. I also exchanged the evaluation datasets to mutiple ones that are more suitable for this task and more realistic in nature.
\item Originally, the model only incorporated the protocol and the port for each flow. I extended this to the direction (from or to host) as well as the size of each flow, which improved detection rates especially for brute-force attacks and sql injections. For this, I came up with an efficient way to process these additional inputs without significant increase of model size.
\item Similarly, the original model was a standard recurrent neural network with one layer. I extended this to a bidirectional LSTM network with multiple layers, which required careful parameter calibration and further boosted detection rates. Depicted in Fig. \ref{fig:LSTM} is a comparison between the original model and my extended model.
\item The detection method was changed from an overall host classification to a session classification using a scoring threshold, which is more realistic in a real-world deployment due to the high imbalance between benign and malicious traffic.
\item I replaced the CTU-14-dataset with the more suitable datasets CICIDS-17 and UGR-16, and identified suitable data traces for modelling and analysis. 
\item I carved out the novelty and contribution of this work more, and implemented three comparision benchmark models to highlight the benefit of our model. I also highlighted the differences between our work and recent applications of LSTMs to intrusion detection.
\end{enumerate}

\begin{figure}
\centering

\includegraphics[width=0.49\textwidth]{images/rnn_FSA.png}
\includegraphics[width=0.49\textwidth]{images/LSTM_design_bi2.jpg}
\caption{Architectures of the initial model (left) and the extended
LSTM network I created (right) for modelling sequences of network flows.}
\label{fig:LSTM}
\end{figure}

The developed model achieves significantly better results than the implemented benchmark models, with 6 out of 7 attacks being detected reliably and an overall AUC (area under ROC-curve) improvement of more than 100\% to the next best model.

Since the paper is now in under my responsibility, and due to all the efforts I put into its improvement, we agreed that I would be the first author of this work in the event of publication. Unfortunately, due to the challenges described in Section \ref{Sec:Problems}, we were so far unable to get this work accepted at a suitable venue. We first submitted the manuscript to the ACSAC conference, where the general consensus was that the application of LSTM networks for network anomaly detection is not novel enough, and that there is not enough connection between the used methodology and the detected attacks.
After efforts to improve on these issues, we attempted a revised manuscript to the CODASPY conference. Again, the main criticism here was novelty and scope of the methodology, and scepticism about the translation of results to real-world application. After more thorough revisions, highlighting of the papers novelty as well as the addition of additional modern baseline models, we have submitted a new manuscript to the DIMVA 2020 conference as a final attempt. 

Due to these difficulties, I spent a lot more time with this project than I originally intended, in total about 6.5 months. We are awaiting the response of the reviewers at the DIMVA 2020 conference, but do not intend to further pursue any substantial flow-based models.

\subsubsection{Datasets and data wrangling} 
 
A vital part of this project is the quality and understanding of available datasets. I spent a considerable amount of time, both for this sub-project and in general, gathering different datasets, studying information describing them, and exploring their content to prepare suitable data for each sub-project.


\subsection{Stint at BT - Stepping stone detection}\label{Sec:BTstint}

%As part of my CASE PhD scholarship, I spent six weeks with my industrial sponsor at BT Labs Adastral Park in August and September 2019. Before starting this stint, I met with my industrial supervisors to define a project to work on that is both related to my PhD and is a relevant problem for BT. During this meeting, we agreed that the problem of detecting stepping stones was a suitable topic. 

In a stepping stone scenario, an attacker launches an attack not from their own computer but from intermediary hosts within an enterprise network that were previously compromised, often using an interactive relay session. A common approach in the literature to detect stepping stones is to identify correlation between two connections on a potential intermediary host. Attackers try to evade detection by inserting chaff packets and delays to make the connection appear uncorrelated. Before starting this 6-week stint, I met with my industrial supervisors where we agreed that the problem of detecting stepping stones is of relevance for them and therefore a suitable topic for my time at BT Labs

The biggest challenge for this problem is that there are no available datasets available that describe stepping stone behaviour. Due to the success of the  DetGen framework, I started to implement several scenarios of interactive traffic relays using ssh-tunnels and netcat/netem for chaff and delay insertion, depicted in Fig. \ref{stepstone}. With this, I was able to generate significant amounts of traffic with a controllable amount of noise and delay to train and assess correlation models. 
I furthermore implemented a state-of-the-art method for connection correlation \cite{nasr2018deepcorr} that uses a deep convolutional neural network as a benchmark to compare a future model with. The model was able to identify relayed traffic when the connections were not subject to the mentioned evasion tactics, but degraded significantly when chaff and delays were added, which makes it unsuitable for real-world deployment and does not improve the current state-of-the-art. 


\begin{figure}
\centering
\includegraphics[width=0.7\textwidth]{images/Step_stones.png}
\caption{Implementation of the stepping stone scenario for traffic generation.}\label{stepstone}
\end{figure}

After more consultation with a security expert, the scope of this project has been altered, which I describe in Section \ref{Bla}

%After finishing the stint at BT Labs, I continued to work on the traffic generation for a bit further before we had a call with Jake Hill, a security expert at BT. This call was meant to provide field knowledge to confirm and/or improve the data generation set-up. However, Jake stated that the problem of attackers launching attacks from intermediary hosts is after all not of great relevance for BT's operations. Instead, his notion of stepping stones described simple proxies relaying services (more on this in Section \ref{Sec:Relay}). In addition, further investigation suggests that the consensus in the literature is that connection correlation produces too many false positives and is not applicable in real-world scenarios. 







\subsection{Modelling of connection setup via LSTM encoders}\label{Sec:Encoder}

The distinct contextual behaviour of an applications manifests itself most clearly in the first few packets exchanged in a connection. This is the stage in a connection during which a specific client or server request is transmitted, encryption keys are exchanged, users authenticate themselves with passwords, ports for successive connections are defined, etc. This distinction goes far beyond individual traffic protocols, as even a single application usually can exert different actions which translate to different contextual behaviours in this initial negotiation phase. 

The significance of the initial negotiation phase is bolstered by two publications on the area of traffic classification that share the same conclusion and train clusters and classifiers on the metadata of the first five to ten packets to distinguish different applications \cite{bernaille2006traffic,crotti2007traffic}.

Learning precise contextual representations of this initial negotiation phase from applications running on a computer has several main benefits for this project: 

\begin{itemize}
\item Several types of attacks exploit loopholes accessible at the negotiation stage. A precise contextual representation model could detect anomalous deviations in particular packet parameters from the learned behaviour. A simple example of such a deviation from expected behaviour would occur during a \textit{buffer overflow attack}, which overflows an input buffer (such as for a password) to directly modify memory locations. This should be observable as a significant deviation in the corresponding packet size.

\item Newly installed malware will most likely exhibit different than normal behaviour in this stage, from very different negotiation procedures to just slight deviations in the packet interarrivals.

%\item The translation of contextual negotiation structures into different behaviour groups could be used to associate the corresponding flow with particular actions, i.e. to give the flow one or more labels. To be meaningful, the identified groups have to correspond to actual contextual behaviours and should be consistent along similar actions. 
%Such a flow labelling could be very helpful for understanding contextual structures of flow traffic, and consequently for anomaly detection on a higher level, such as the described work by Chen et al.\cite{chen_more_2016}. I will describe this more in Section \ref{Curmet}.

\item Malicious traffic that tries to disguise itself by using common ports can be identified as a mismatch.

%\item As applications are updated, their particular traffic generation distribution $P(X)$ can also  gradually change, causing corresponding traffic to be potentially flagged as anomalous by current anomaly detection methods. A representational model could identify common contextual substructures between traffic instances and thus indicate that they originate from an updated application. More detail will be given in Section \ref{Robustness}.

\end{itemize}

In order to generate accurate representations of negotiation phases, I have implemented an LSTM-autoencoder model that can simultaneously work as an anomaly detection model as well as an embedding generator for sequence clustering, see Fig. \ref{LSTM2}. I have tested this model on initial test-datasets, on which it achieves excellent results while being able to spot artificial anomalies accurately. I have also added a simple k-nearest neighbour clustering algorithm, however its performance as well as the ability to identify anomalies related to malicious activity will have to be evaluated on the larger CICIDS-17 dataset.  

\begin{figure}\label{LSTM_Enc}
\centering
\begin{subfigure}[b]{0.5\textwidth}\label{LSTM1}
\includegraphics[width=\textwidth]{images/LSTM_Encoder.jpg}
\caption{}
\end{subfigure}
\begin{subfigure}[b]{0.34\textwidth}
\includegraphics[width=\textwidth]{images/MNIST.png}
\caption{}\label{LSTM2}
\end{subfigure}
\caption{Visualisation of the design of an LSTM Autoencoder (a), taken from https://machinelearningmastery.com/lstm-autoencoders/, and the embedding of different types of handwritten digits by an autoencoder.}
\end{figure}

\subsubsection{Scope of the project for publication}

Due to the difficulties described in Section \ref{Sec:Problems} of publishing anomaly-based methods in network intrusion detection, we are currently rethinking the scope this project should take for publication. One idea is to pitch it simply as a traffic classification and clustering method, since the evaluation and applicability demonstration is more straightforward.



\section{Developments in related work}

Last year, I prepared an extensive literature review on network intrusion and general anomaly-based intrusion detection methods as well as datasets and data sources. Here, I will outline some recent developments in the literature related to this project.

\subsection{Intrusion detection}

%Contextually closest to our work might be the BASTA system by Pellegrino et al. \cite{Pellegrino2017}. In their approach, a timed automata of malware behaviour is learned and used to detect malicious behaviour. Their results indicate that behavioural models of both benign and malicious patterns show promise in detecting new malware. However, their approach learns behaviour from malicious traffic and is thus not robust to unknown attacks.

Researchers continue to apply ML techniques to intrusion detection. One of the developments recently is the increasing adoption of artificial neural networks to build intrusion detection classifiers or anomaly-based models, especially using networks based around convolutional, encoding, or recurrent layers have.
Notable examples include Kitsune, an ensemble of autoencoders for classification \cite{mirsky2018kitsune}, a light-weight recurrent network for anomaly detection by Radford et al. \cite{radford2018network}, or a hybrid model for classification and anomaly-detection using convolutional layers by Wu et al. \cite{wu2018novel}, which I discussed in more detail in the paper described in Section \ref{Sec:Short-term}.
Outside of network intrusion detection, notable applications of LSTM networks in security include Tiresias \cite{shen2018tiresias}, an LSTM network for security event forecasting with tremendous accuracy, and DeepLog \cite{du2017deeplog}, an LSTM network to learn a system's log patterns (e.g., log key patterns and parameter values) from normal execution in regulated environments such as Hadoop with limited variety of events.

Additionally, more attention has been paid to create advances in adaptive online learning methods for network intrusion detection, such as Kitsune \cite{mirsky2018kitsune} or by Roshan et al. \cite{roshan2018adaptive}.

%Notable work includes Tiresias \cite{shen2018tiresias}, an LSTM network for security event forecasting with tremendous accuracy. The authors use one-step forecasting of symbolic security event sequences to predict future steps of an attack in a noisy environment. 

%Outside of network traffic, Du et al. \cite{du2017deeplog} proposed DeepLog, an LSTM network to learn a system's log patterns (e.g., log key patterns and parameter values) from normal execution. The authors present a novel log parser to create a sequence of symbolic log keys, which is then also modelled using one-step forecasting.
%The authors achieve good detection results in regulated environments such as Hadoop with limited variety of events (e.g., 29 events in Hadoop).

%Common approaches to anomaly-based network intrusion detection attempt to characterise networks with suitable aggregate values such as traffic volume, entropy of destination ports~\cite{Lakhina2005}, and statistical variables on flows~\cite{Gu2008}, or via automatic feature engineering \cite{cordero2016analyzing}. Models of normal or abnormal behaviour can be trained by exploring patterns between these features~\cite{Gu2007,Wurzinger2009}. Detection is usually by a threshold function on the deviation from, or the similarity to, these trained models. 

%Some anomaly-based methods look at the anomaly of individual events, mostly isolated flows or packets. These approaches are often based on classification or  clustering algorithms \cite{lin2015cann,javaid2016deep}. Other approaches motivate statistical methods to identify anomalous events in network traffic \cite{mahoney2002learning}. %Unlike approaches on aggregated traffic, an event-based approach is independent of the traffic volume and therefore more suitable to identify low volume activities, such as data exfiltration, R2L/U2R attacks, or C\&C communication. 
%However, many event-based approaches are tested on older datasets no longer considered relevant ~\cite{garcia_empirical_2014}. Nisioti et al. \cite{nisioti2018intrusion} conclude that data exfiltration, R2L, and U2R attacks are not yet reliably detected by anomaly-based methods. 

%Very few approaches try to model temporal dependencies of unaggregated events, and those that do are usually targeted towards very specific misbehaviours \cite{bodenham_adaptive_2014,noble_real-time_2018,zhang2000detecting}. 


%\subsection{Recurrent Neural Network Applications}

%A recurrent neural network (RNN) is a directed chain of regular feedforward network, with each individual network cell taking a vector $x_k$ of the input sequence $\{x_1,\dots,x_n\}$ as input. The RNN is able to retain information about the state of a sequence by also passing a value of the internal layer as additional input to the next network cell in the chain. LSTM (long short-term memory) and GRU (gated recurrent units) networks improve several shortcomings of RNNs such as the vanishing gradient problem, and their performance is generally thought to be superior.


%The application of recurrent neural networks to cyber security %and in particular intrusion detection 
%has risen in popularity recently. 
%Notable work includes Tiresias \cite{shen2018tiresias}, an LSTM network for security event forecasting with tremendous accuracy. The authors use one-step forecasting of symbolic security event sequences to predict future steps of an attack in a noisy environment. 
%%Both the scope and the methodology of Tiresias have significant differences to our approach.
%The aim of Tiresias is not intrusion or anomaly detection, but attack forecasting, and the evaluation is therefore done solely in terms of event prediction accuracy of individual events. 
%Methodologically, the authors rely on a pre-existing event vocabulary provided through the data format.% and predict a univariate output probability. \textcolor{red}{verify this}


%To date, we count eleven published applications of recurrent neural networks (RNNs) to network traffic for intrusion detection. The majority of these approaches  relies on labelled attack data for classification.%, and therefore does not offer the benefits of anomaly detection. 
%A prominent example of this comes from Kim et al. \cite{kim2016long}, who classify flow sequences based on 41 numeric input features.
%Anomaly-based approaches usually rely on iterative one-step ahead forecasts within sequences, with the forecasting error acting as the anomaly indicator. This is for instance done by Bontemps et~al.~\cite{Bontemps2016}, who use sequences of aggregated traffic features as input. Input features in these approaches are mostly numerical, with only \cite{radford2018network} creating event vocabularies from flow protocols and sizes.
%Little exploration of the usage of stacked recurrent layers or input embeddings has been done.
%However, all RNN-based approaches share several common evaluation pitfalls, which make it impossible to assess their suitability for U2R and R2L detection in real-world applications. We describe these problems in Section \ref{Sec:Evalmal}.
% in each of the presented approaches , which we discuss in Section \textcolor{red}{xxxx}. This makes it difficult to assess ....

%A related application to ours was presented by Bontemps et~al.~\cite{Bontemps2016}, which uses LSTM model to detect group anomalies in network traffic via sequential modelling. The model uses three numerical input parameters from aggregated traffic for one-step forecasting, which is then compared to the actual values. Evaluation is done on the outdated KDD-99 dataset. The model construction and anomaly scoring differs substantially from ours as the raw input can be fed directly to the model input layer. Similarly, the detection scope focuses on long-term group anomalies with larger volume rather than contextual anomalies.

%Outside of network traffic, Du et al. \cite{du2017deeplog} proposed DeepLog, an LSTM network to learn a system's log patterns (e.g., log key patterns and parameter values) from normal execution. The authors present a novel log parser to create a sequence of symbolic log keys, which is then also modelled using one-step forecasting. %In contrast to our model, DeepLog incorporates additional numerical values in a case-by-case manner, and creates no sequential dependencies between the keys and the values as their anomaly is assessed independently of each other. 
%The authors achieve good detection results in regulated environments such as Hadoop with limited variety of events (e.g., 29 events in Hadoop).%, where they trained on small fractions of normal traffic. Network traffic in contrast is significantly more heterogenous and multi-step attacks occur in noisy environments,  which makes predictions in this setup a far harder problem.


%as the model is not suitable for attack discovery. Our approach in contrast does not emphasise the accuracy of individual event predictions, but uses the joint predicted likelihoods to examine the contextual anomaly of sequence and whether a separation in the anomaly score distributions of benign and malicious events exists. Methodologically, the authors rely on a pre-existing event vocabulary provided through the data format and predict a univariate output probability from a univariate input vocabulary using a shallow LSTM architecure. Our work discusses efficient vocabulary construction for multiple variables, and presents an extended LSTM architecture that produces multivariate output probability from multiple input vocabularies via embedding layers.

\subsection{Data}

The Canadian Institute of Cyber-Security has recently released a new dataset CICIDS-18 that improves on the existing CICIDS-17 dataset \cite{sharafaldin2018towards} in terms of realism of benign activity, and by creating particular attack scenarios based on the implemented network topology rather than isolated attacke events. 

Container networks have recently been adopted to conduct traffic generation experiments, such by Fujdiak et al. \cite{fujdiak2018ip} who use containerized web servers to collect DoS-traffic. Furthermore, significant effort has been put into the creation of large-scale virtualization frameworks to provide automatized network testbeds \cite{crussell2015minimega, badiger2018violet}.

%To evaluate their ability to model the behaviour of a network and to identify malicious activity and network intrusions, new methods have to be tested using existing datasets of network traffic. This network should ideally contain realistic and representative benign network traffic as well as a variety of different network intrusions. However, as network traffic contains a vast amount of information about a network and its users, it is notoriously difficult to release a comprehensive dataset without infringing the privacy rights of the network users \cite{sperotto2009labeled}. Furthermore, the identification of malicious traffic in network traces is not straightforward and often requires a significant amount of manual labelling work. Introducing malicious software into an enterprise network would be impossible for ethical and security reasons. For that reason, only about four structured datasets for network intrusion containing real-world traffic and attacks are available openly. The most recent and notable real-world datasets have been released from the Los Alamos National Laboratory (LANL) in 2015 and 2017 \cite{akent-2015-enterprise-data, turcotte17}, and the University of Granada (UGR) in 2016 \cite{macia2018ugr}. Both datasets contain network flow traffic data from a large number of hosts collected over multiple months, giving an accurate representation of medium- to large-scale structures in benign traffic. However, the amount of attack data is small and insufficient for accurate detection rate estimation. Furthermore, packet-level data is not available for both datasets. Other real-world datasets, such as CAIDA 2016 \cite{walsworth2015caida} or MAWI 2000 \cite{sony2000traffic}, provide packet headers, but are unstructured and contain no labeled attack data at all.




\section{Future plans}

\subsection{Challenges with publishing in Network Anomaly Detection and ACSAC conference}\label{Sec:Problems}

The original scope of this PhD-project was to built contextual models that represent software behaviour primarily from network traffic and potentially other external data sources, for adaptive anomaly intrusion detection.  
Over the course of the last year, it became clear that the successful publication of anomaly-based methods network intrusion detection methods is difficult today. This realisation was reflected during our unsuccessful attempts to publish the contextual network flow model described in Section \ref{Sec:Short-term} at the ACSAC and CODASPY conferences. Despite improving detection rates and false positive rates significantly on U2R and R2L on contemporary datasets, the main criticisms were a lack of novelty in terms of intrusion detection model and a general scepticism of real-world applicability. Prior attempts publication attempts by my supervisor and collaborating researchers yielded similar responses.

This is in line with conversations I had with senior researchers at the ACSAC conferences, who highlighted that anomaly-based methods have been applied to network traffic for over 15 years without convincing results. There seems to be a general scepticism of the detection capabilities and improvements that general-purpose anomaly-detection methods can provide in real-world scenarios due to high false-positive rates, in particular for network traffic. In the context of the proposed project, this raises doubt if research question 4 can be answered adequately for a PhD-project concerning general models of network behaviour. This also made us re-evaluate the scope of the project discussed in Section \ref{Sec:Encoder}.

General advice were to identify very specific applications for which taylored machine learning methods have the potential to yield good results. This is in line with the findings of Sommer and Paxson \cite{sommer_outside_2010} that anomaly detection methods should be "keeping the scope narrow" and providing an answer for "why the particular choice promises to perform well in the intended setting, considering domain-specific properties". "If one cannot make a solid argument for the relation of the features to the attacks of interest, the resulting study risks foundering on serious flaws."

\subsection{BT project}\label{Bla}

As part of my CASE PhD scholarship, I am spending 12 weeks in total with my industrial sponsor at BT Labs Adastral Park in the context of a student placement. While there, I am supposed to conduct research that is both relevant to my PhD-topic and to the operations of BT. Choosing a suitable topic is therefore not completely straightforward and could mean that the research conducted during the placement does not align completely with my PhD-topic.


In August and September 2019, I spent the first six weeks at Adastral Park. Before starting this stint, I met with my industrial supervisors to define a suitable project to work on. During this meeting, we agreed that the problem of detecting stepping stones was a suitable topic, as it was identified as a pressing issue for BT by their operational team, and could potentially benefit from from the developed DetGen framework described in Section \ref{Sec:BTstint} and the traffic sequence embedding techniques described in Section \ref{Sec:Encoder}.


After finishing the stint at BT Labs, I continued to work on the traffic generation for a bit further before we had a call with Jake Hill, a security expert at BT. This call was meant to provide field knowledge to confirm and/or improve the data generation set-up. However, Jake stated that the problem of attackers launching attacks from intermediary hosts is after all not of great relevance for BT's operations. Instead, his notion of stepping stones described simple proxies relaying services (more on this in Section \ref{Sec:Relay}). In addition, further investigation suggests that the consensus in the literature is that connection correlation produces too many false positives and is not applicable in real-world scenarios.

%\subsubsection{Scope of the project for publication}
With this information, I decided to scale this project down and produce a simple evaluation of existing connection correlation methods. Since the major contribution of this work so far is the large amount of detailed and varied data I can produce, this allows for the first time an independent assessment of existing methods. So far I have implemented and evaluated four different methods, and am in the process of finishing this project. I am currently producing a small paper from it, which I intend to publish at a smaller workshop or conference. 

\subsection{Submission of Stepping stone project and negotiation phase model}
%\section{Introduction and motivation}

With work being almost finished for the stepping stone project and the negotiation phase model also being well on the way, I am planning to write each project up into a paper for publication. Since the scope for each project was scaled back a bit, I am intending to submit them to smaller venues with a higher acceptance rate, and do not intend to spent more than three months completing both. A suitable venue for both might be the 2020 Conference on Machine Learning for Cyber Security.

\subsection{QUIC anomaly detection}

An advice I received at the ACSAC conference from Guofei Gu, the Program Chair, was to identify very specific and novel applications of machine learning methods to intrusion detection in order to produce publications that could be accepted at renowned venues. One such applications could be to the new transport layer QUIC. QUIC seeks to improve performance of connection-oriented web-applications using TCP. It is implemented on top of UDP and implements its own TCP-like packet control mechanisms. It allows for multiplexed HTTP-connections and resolves head-of-line blocking during packet loss as well as reducing latency by minimising round-trips during connection establishment. Furthermore, much of the QUIC implementation is moved from kernel to user space, which allows continuous updates of the protocol.

According to an NGINX-spokesperson, "since the protocol is new and things like stack optimization etc. still to catch up and since it's all user-space, there is a possibility to make changes to protocol very rapidly. This generates a higher attack surface than you would have over more layered approach with TCP and http on top." Initial investigations showed that there exists no research on mitigating intrusions over the QUIC protocol.%, which \textcolor{red}{...}

Due to the implementation in user-space, QUIC may introduce vulnerabilities that allow remote code execution on a host, such as in \textit{CVE-2017-15407} and \textit{CVE-2017-15398}. The detection of such code executions by building a combined model of QUIC packet exchanges and process starts/system calls therefore seems like a promising project that provides both novelty and relevance.

In particular, I believe the following conditions would allow for interesting results:
\begin{itemize}
\item Operation on a host (server or client) level
\item Combination of unencrypted packet packet stream and system calls/process starts corresponding
\item A sequential model that applies NLP-techniques to packet content and predicts probability of process start or particular system call (which could then correspond to code execution)
\item Traffic and system call/process log collection using a containerized framework.
\end{itemize}

In total, I would assign about six months work in this project to conclude.


One difficulty in this project is that there do not exist many identified vulnerabilities in the QUIC protocol yet, of which none are known to have been used in a successful attack. Therefore, it might be difficult to get enough malicious data for result validation. At this stage of my PhD, beginning a project that is not certain to be successful bears significant risk.  I am therefore currently spending a small amount of time reaching out to experts to verify that data for model validation is available and that the scope of this project is of relevance before fully committing to it.



\subsection{Service relay detection}\label{Sec:Relay}

As mentioned in Section \ref{Sec:BTstint}, disussion with a security expert at BT Labs indicated that the detection of simple proxy servers that relay protected services to third parties from the perspective of an ISP is a relevant and promising research project. Specific characteristics of this problem are:

\begin{itemize}
\item Unlike the original stepping stone problem, these relay proxies operate in a simplistic fashion and do not use evasion tactics. However, content can be forwarded using a different application or protocol than in the first connection.
\item Packets are sampled before observation, meaning that only every n-th packet for each connection is observed.
\item Benign proxies exist that can increase false-positives.
\end{itemize}

Initial investigations that I conducted showed that there are no publications yet that address this problem in any way, which indicates the potential for novel contributions. Since there exists no description or analysis of such proxies at all, this however also means that we are reliant on BT for knowledge and guidance on the problem definition and proxy operation mode. Also since no public dataset exists, we would have to implement and generate our own dataset and feedback with BT to check if it resembles the behaviour of such proxies. At the moment it seems that a suitable start would be to focus on video relay. Necessary steps for this project are:

\begin{itemize}

\item Implement a docker traffic generation scenario to generate realistic data, and parse them in a sampled manner.
\item start designing and implementing detection methods. As there are no evasion tactics involved, simple cumulative sum or moving window statistics with a p-value threshold seem like a good start.
\item Test these methods on the data with a suitable background of independent connections as well as benign proxies. Obtaining simple background data is not challenging, however we will have to discuss how and to what extend benign proxies should be included in the background data.
\item Evaluate and adjust/improve existing methods.

\end{itemize}

As we are reliant on the cooperation with BT Labs, we are not completely certain yet if this project will go ahead yet. Currently, they are retrieving data of service relay examples. We will have a further discussion with them later in April, which will bring more clarity. 

\subsection{Extension of Docker framework}\label{Sec:dockerext}

Due to very positive feedback at the workshop as well as encouragements and suggestions to extend the framework, Robert Flood and I are working further to extend the current traffic generation framework. The overall goal is to provide a tool that enables researchers to generate large data quantities of specific services of interest in arbitrary network configurations, complemented by multi-step attack scenarios in differing executions. This would be of specific interests to researchers who apply machine-learning techniques to specific network applications for which there is not sufficient realistic public data available.

Particular goals are:

\begin{enumerate}
\item Extend the framework to create datasets that resemble full fledged computer network with variable topology. For this, several subtasks need to be completed:

\begin{enumerate}

\item Embed all scenarios in a \textit{Mininet} framework in order to allow the fast inclusion of switches, routers, etc.

\item Build a mechanism that can generate variable or random network topologies.

\item Create a launch mechanism that starts and executes different traffic scenarios for a given network topology at times and locations drawn from appropriate distributions that resemble empirical network behaviour.

\end{enumerate}
\item Include the collection of application logs and system call logs for each container. These will then be matched with the corresponding traffic captures and receive the same ground truth labels.

\item Generate different multi-step attack executions on a set of network topologies to capture the similarities and disimilarities between different attack techniques and tactics.

\end{enumerate}

An advantage of this project is the pre-existing DetGen body, that is being extended here. This means that the timescale of the project depends on how many extensions should be implemented. It should be relatively easy to finish the project quikcly at any given time after about two months of work while having sufficient results to publish. 
%Since I am not the lead on this project, I currently do not have a timescale for its completion.


\section{Thesis plan}

In the light of the problems described in Section \ref{Sec:Problems} that we encountered in the field of anomaly-based intrusion detection, I believe that the scope of this PhD-project has to be altered slightly. As there will not be enough material directly concerning anomaly detection, the formulation of building anomaly-detection models describing software behaviour should be relaxed to general applications of ML (not just anomaly detection) in specific areas related to software defined behaviour. 
The overall unifying theme of this PhD so far has been centered around small-scale traffic structures generated by software-defined computer interactions and applications of ML language models to it, in other words \textbf{Modelling computer interactions as a language}.
This could be based of the reoccurring use of traffic (and potentially system/program logs) generation for machine learning. The generated traffic could then be verified as valuable by the implemented intrusion detection applications.

All applications implemented so far except for the flow-level model are driven (in part) by our traffic generation:
\begin{itemize}
\item Flow-level LSTM model

\item stepping stone detection
\item traffic relay
\item LSTM encoder
\item QUIC anomaly detection
\end{itemize}

Overall, all these applications except for the traffic relay detection are concerned with software-defined fine-grained structures. Below, I outline the different chapters that I believe should be included in my thesis:

\begin{enumerate}


\item Introduction and related work

This chapter could largely draw from the existing introduction in the research proposal as well as the extensive literature survey I conducted. Updates on the scope as well as recent developments in related work would have to be added. %This should take less then three weeks.

\item Background: Anomaly detection and challenges in security

This chapter outlines the motivation to use anomaly-based detection models instead of classification-based ones. It furthermore highlights why anomaly detection is more difficult in security than in other areas, and what currently prevents it from being deployed outside of academia.

\item Background: Language models and their application to security

This chapter briefly outlines different techniques used in language modelling,  and how they can be used to build data representation useful for anomaly-detection. It also discusses previous applications of language models in security.

\item Data sources, datasets, and data generation with realistic small scale structures

This chapter will draw largely on the work conducted for the DetGen traffic generation framework.

\item Computer communication structures and the effect of malicious behaviour on them

This chapter will describe the different structures that the different layers of software-defined communication can have on the collected data. These descriptions and their corroboration can be taken from work in each of the projects described above. Furthermore, this chapter will describe how attacks can alter these structures due to the distinct approach they are taking, and why it is worth building models that focus on small-scale traffic structures.

\item Traffic as a language and detection models

This chapter will describe how network traffic can be described by a language model, and how to construct anomaly-based models from it. The chapter will then proceed to describe the different approaches I worked on and their respective results:

\begin{enumerate}

\item Flow-based modelling

\item Connection setup model

\item Traffic relating to process initialisations in the QUIC protocol

\item Detecting similarity in computer connections


\end{enumerate}

\item Conclusions

\end{enumerate}

\subsection{Thesis completion plan}

\begin{enumerate}

\item month
\begin{itemize}
\item Finish stepping stone project
\item Inquire about the prospect of QUIC project
\item Discuss with BT the boundary conditions and data sources for a service relay problem 
\end{itemize}

\item month
\begin{itemize}
\item Work on connection setup project
\item Start producing paper from connection setup project
\item Finish inquiry about the prospect of QUIC project
\end{itemize}

\item month
\begin{itemize}
\item Finish connection setup project
\item Start developing anomaly-detection model for QUIC project
\end{itemize}

\item month
\begin{itemize}
\item Continue development of model for QUIC project
\item Work on dataset for QUIC project
\end{itemize}

\item month
\begin{itemize}
\item Work on dataset for QUIC project
\item Gather data representing malicious QUIC traffic
\end{itemize}

\item month
\begin{itemize}
\item Evaluate and tune results for QUIC project
\item Start producing paper for QUIC project
\end{itemize}

\item month
\begin{itemize}
\item Finish paper for QUIC project
\item Work on data generation for service relay project
\end{itemize}

\item month
\begin{itemize}
\item Begin 2. stint at BT
\item Work on model for service relay project
\end{itemize}

\item month
\begin{itemize}
\item Finish 2. stint at BT
\item Evaluate model for service relay project
\end{itemize}

\item month
\begin{itemize}
\item Discuss further steps in service relay project, potentially produce paper
\item Extend DetGen framework
\end{itemize}

\item month
\begin{itemize}
\item Extend DetGen framework
\end{itemize}

\item month
\begin{itemize}
\item Extend DetGen framework
\item Produce paper for DetGen framework
\end{itemize}


\textbf{Thesis write-up}

\item month
\begin{itemize}
\item Revise literature review
\item Complete chapter 1 and 2
\item Compile a map of different language models for chapter 3
\end{itemize}
\item month
\begin{itemize}
\item Complete chapter 3
\item Assess the requirements for chapter 4 and compare to results of DetGen project
\item Start working on chapter 4
\end{itemize}

\item month
\begin{itemize}
\item Complete chapter 4
\item Compile a map of different traffic structures observed in each project
\item Compile a map of different attacks and their effect on respective structures
\item Start chapter 5

\end{itemize}
\item month
\begin{itemize}
\item Complete chapter 5
\item Assess the results of each project, and decide order and weight of each project on chapter 6
\item Decide if anything is needed as input for chapter 6
\item Start chapter 6
\end{itemize}

\item month
\begin{itemize}
\item Complete chapter 6
\end{itemize}
\end{enumerate}



%\addcontentsline{toc}{section}{Bibliography}
\bibliographystyle{abbrv}
\bibliography{refs}

\end{document}